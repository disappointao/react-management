{"ast":null,"code":"import \"antd/es/card/style\";\nimport _Card from \"antd/es/card\";\nimport \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\nimport \"antd/es/cascader/style\";\nimport _Cascader from \"antd/es/cascader\";\nimport \"antd/es/icon/style\";\nimport _Icon from \"antd/es/icon\";\nimport \"antd/es/message/style\";\nimport _message from \"antd/es/message\";\nimport \"antd/es/input/style\";\nimport _Input from \"antd/es/input\";\nimport \"antd/es/form/style\";\nimport _Form from \"antd/es/form\";\nvar _jsxFileName = \"/Users/ao/Desktop/management/src/view/product/add.jsx\";\nimport React, { Component } from 'react';\nimport LinkButton from '../../components/link-button/button';\nimport RichTextEditor from './richTextEditor';\nimport PicturesWall from './picturesWall';\nimport { reqCategorys, reqAddOrUpdateProduct } from '../../api/index';\nconst Item = _Form.Item;\nconst TextArea = _Input.TextArea;\n\nclass ProductAdd extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      options: []\n    };\n\n    this.initOptions = async categorys => {\n      const options = categorys.map(item => ({\n        value: item._id,\n        label: item.name,\n        isLeaf: false\n      }));\n      const update = this.update,\n            product = this.product;\n      const pCategoryId = product.pCategoryId;\n\n      if (update && pCategoryId !== '0') {\n        const subCategorys = await this.getCategorys(pCategoryId);\n        const childOptions = subCategorys.map(item => ({\n          value: item._id,\n          label: item.name,\n          isLeaf: true\n        }));\n        const targetOption = options.find(option => option.value === pCategoryId);\n        targetOption.children = childOptions;\n      }\n\n      this.setState({\n        options: options\n      });\n    };\n\n    this.getCategorys = async parentId => {\n      const result = await reqCategorys(parentId);\n\n      if (result.status === 0) {\n        const categorys = result.data;\n\n        if (parentId === '0') {\n          this.initOptions(categorys);\n        } else {\n          return categorys;\n        }\n      }\n    };\n\n    this.loadData = async selectedOptions => {\n      const targetOption = selectedOptions[0];\n      targetOption.loading = true;\n      const subCategorys = await this.getCategorys(targetOption.value);\n      targetOption.loading = false;\n\n      if (subCategorys && subCategorys.length > 0) {\n        const childOptions = subCategorys.map(item => ({\n          value: item._id,\n          label: item.name,\n          isLeaf: true\n        }));\n        targetOption.children = childOptions;\n      } else {\n        targetOption.isLeaf = true;\n      }\n\n      this.setState({\n        options: [...this.state.options]\n      });\n    };\n\n    this.submit = () => {\n      this.props.form.validateFields(async (error, values) => {\n        if (!error) {\n          const name = values.name,\n                desc = values.desc,\n                price = values.price,\n                categoryIds = values.categoryIds;\n          let pCategoryId, categoryId;\n\n          if (categoryIds.length === 1) {\n            pCategoryId = '0';\n            categoryId = categoryIds[0];\n          } else {\n            pCategoryId = categoryIds[0];\n            categoryId = categoryIds[1];\n          }\n\n          const imgs = this.getImg.current.getImg();\n          const detail = this.getHtml.current.getDetail();\n          const product = {\n            name,\n            desc,\n            price,\n            imgs,\n            detail,\n            pCategoryId,\n            categoryId\n          };\n\n          if (this.update) {\n            product._id = this.product._id;\n          }\n\n          const result = await reqAddOrUpdateProduct(product);\n\n          if (result.status === 0) {\n            _message.success(\"\".concat(this.isUpdate ? '更新' : '添加', \"\\u5546\\u54C1\\u6210\\u529F!\"));\n\n            this.props.history.goBack();\n          } else {\n            _message.error(\"\".concat(this.isUpdate ? '更新' : '添加', \"\\u5546\\u54C1\\u5931\\u8D25!\"));\n          }\n        }\n      });\n    };\n\n    this.getImg = React.createRef();\n    this.getHtml = React.createRef();\n  }\n\n  validatePrice(rule, value, callback) {\n    if (value * 1 > 0) {\n      callback();\n    } else if (value * 1 <= 0) {\n      callback('单价必须大于零');\n    }\n  }\n\n  componentWillMount() {\n    const _ref = this.props.location.state || {\n      product: ''\n    },\n          product = _ref.product;\n\n    this.update = !!product;\n    this.product = product || {};\n  }\n\n  componentDidMount() {\n    this.getCategorys('0');\n  }\n\n  render() {\n    const getFieldDecorator = this.props.form.getFieldDecorator;\n    const product = this.product,\n          update = this.update;\n    const _this$product = this.product,\n          categoryId = _this$product.categoryId,\n          pCategoryId = _this$product.pCategoryId;\n    const categoryArry = [];\n\n    if (update) {\n      if (pCategoryId == '0') {\n        categoryArry.push(categoryId);\n      } else {\n        categoryArry.push(pCategoryId);\n        categoryArry.push(categoryId);\n      }\n    }\n\n    const title = React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132\n      },\n      __self: this\n    }, React.createElement(LinkButton, {\n      onClick: () => this.props.history.goBack(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133\n      },\n      __self: this\n    }, React.createElement(_Icon, {\n      type: \"arrow-left\",\n      style: {\n        fontSize: 20\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134\n      },\n      __self: this\n    })), React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136\n      },\n      __self: this\n    }, this.update ? '修改商品' : '添加商品'));\n    const formItemLayout = {\n      labelCol: {\n        span: 2\n      },\n      wrapperCol: {\n        span: 8\n      }\n    };\n    return React.createElement(_Card, {\n      title: title,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144\n      },\n      __self: this\n    }, React.createElement(_Form, Object.assign({}, formItemLayout, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145\n      },\n      __self: this\n    }), React.createElement(Item, {\n      label: \"\\u5546\\u54C1\\u540D\\u79F0\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146\n      },\n      __self: this\n    }, getFieldDecorator('name', {\n      initialValue: product.name,\n      rules: [{\n        required: true,\n        message: '必须输入商品名称'\n      }]\n    })(React.createElement(_Input, {\n      placeholder: \"\\u8BF7\\u8F93\\u5165\\u5546\\u54C1\\u540D\\u79F0\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153\n      },\n      __self: this\n    }))), React.createElement(Item, {\n      label: \"\\u5546\\u54C1\\u63CF\\u8FF0\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156\n      },\n      __self: this\n    }, getFieldDecorator('desc', {\n      initialValue: product.desc,\n      rules: [{\n        required: true,\n        message: '必须输入商品描述'\n      }]\n    })(React.createElement(TextArea, {\n      placeholder: \"\\u8BF7\\u8F93\\u5165\\u5546\\u54C1\\u63CF\\u8FF0\",\n      autosize: {\n        minRows: 2,\n        maxRows: 6\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163\n      },\n      __self: this\n    }))), React.createElement(Item, {\n      label: \"\\u5546\\u54C1\\u4EF7\\u683C\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167\n      },\n      __self: this\n    }, getFieldDecorator('price', {\n      initialValue: product.price,\n      rules: [{\n        required: true,\n        message: '必须输入商品价格'\n      }, {\n        validator: this.validatePrice\n      }]\n    })(React.createElement(_Input, {\n      type: \"number\",\n      placeholder: \"\\u8BF7\\u8F93\\u5165\\u5546\\u54C1\\u4EF7\\u683C\",\n      addonAfter: \"\\u5143\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176\n      },\n      __self: this\n    }))), React.createElement(Item, {\n      label: \"\\u5546\\u54C1\\u56FE\\u7247\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179\n      },\n      __self: this\n    }, React.createElement(PicturesWall, {\n      ref: this.getImg,\n      imgs: product.imgs,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180\n      },\n      __self: this\n    })), React.createElement(Item, {\n      label: \"\\u5546\\u54C1\\u5206\\u7C7B\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182\n      },\n      __self: this\n    }, getFieldDecorator('categoryIds', {\n      initialValue: categoryArry,\n      rules: [{\n        required: true,\n        message: '必须指定商品分类'\n      }]\n    })(React.createElement(_Cascader, {\n      placeholder: \"\\u8BF7\\u6307\\u5B9A\\u5546\\u54C1\\u5206\\u7C7B\",\n      options: this.state.options,\n      loadData: this.loadData,\n      changeOnSelect: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 190\n      },\n      __self: this\n    }))), React.createElement(Item, {\n      labelCol: {\n        span: 2\n      },\n      wrapperCol: {\n        span: 20\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200\n      },\n      __self: this\n    }, React.createElement(RichTextEditor, {\n      ref: this.getHtml,\n      html: product.detail,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201\n      },\n      __self: this\n    })), React.createElement(Item, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203\n      },\n      __self: this\n    }, React.createElement(_Button, {\n      type: \"primary\",\n      onClick: this.submit,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204\n      },\n      __self: this\n    }, \"\\u63D0\\u4EA4\"))));\n  }\n\n}\n\nexport default _Form.create()(ProductAdd);","map":{"version":3,"sources":["/Users/ao/Desktop/management/src/view/product/add.jsx"],"names":["React","Component","LinkButton","RichTextEditor","PicturesWall","reqCategorys","reqAddOrUpdateProduct","Item","TextArea","ProductAdd","constructor","props","state","options","initOptions","categorys","map","item","value","_id","label","name","isLeaf","update","product","pCategoryId","subCategorys","getCategorys","childOptions","targetOption","find","option","children","setState","parentId","result","status","data","loadData","selectedOptions","loading","length","submit","form","validateFields","error","values","desc","price","categoryIds","categoryId","imgs","getImg","current","detail","getHtml","getDetail","success","isUpdate","history","goBack","createRef","validatePrice","rule","callback","componentWillMount","location","componentDidMount","render","getFieldDecorator","categoryArry","push","title","fontSize","formItemLayout","labelCol","span","wrapperCol","initialValue","rules","required","message","minRows","maxRows","validator","create"],"mappings":"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","sourcesContent":["import  React,{Component} from 'react';\nimport {Card, Icon, Form, Input, Cascader, Button, message} from 'antd';\n\nimport LinkButton from '../../components/link-button/button';\nimport RichTextEditor from './richTextEditor';\nimport PicturesWall from './picturesWall';\nimport {reqCategorys,reqAddOrUpdateProduct} from '../../api/index';\nconst Item=Form.Item;\nconst TextArea=Input.TextArea;\nclass ProductAdd extends  Component {\n  state={\n    options:[]\n  };\n  constructor(props) {\n    super(props);\n    this.getImg = React.createRef();\n    this.getHtml= React.createRef();\n  }\n  validatePrice(rule,value,callback){\n    if(value*1>0){\n      callback();\n    }else if(value*1<=0){\n      callback('单价必须大于零')\n    }\n  }\n  initOptions = async (categorys) => {\n    const options = categorys.map(item => ({\n      value: item._id,\n      label: item.name,\n      isLeaf: false,\n    }));\n    const {update, product} = this;\n    const {pCategoryId} = product;\n    if(update && pCategoryId!=='0') {\n      const subCategorys = await this.getCategorys(pCategoryId);\n      const childOptions = subCategorys.map(item => ({\n        value: item._id,\n        label: item.name,\n        isLeaf: true\n      }));\n      const targetOption = options.find(option => option.value===pCategoryId);\n      targetOption.children = childOptions\n    }\n    this.setState({\n      options:options,\n    })\n    };\n\n  getCategorys = async (parentId) => {\n    const result = await reqCategorys(parentId);\n    if (result.status===0) {\n      const categorys = result.data;\n      if (parentId==='0') {\n        this.initOptions(categorys)\n      } else {\n        return categorys;\n      }\n    }\n  };\n  loadData = async selectedOptions => {\n    const targetOption = selectedOptions[0];\n    targetOption.loading = true;\n    const subCategorys = await this.getCategorys(targetOption.value);\n    targetOption.loading = false;\n    if (subCategorys && subCategorys.length>0) {\n      const childOptions = subCategorys.map(item => ({\n        value: item._id,\n        label: item.name,\n        isLeaf: true\n      }));\n      targetOption.children = childOptions\n    } else {\n      targetOption.isLeaf = true\n    }\n    this.setState({\n      options: [...this.state.options],\n    })\n  };\n  submit=()=>{\n    this.props.form.validateFields(async (error,values)=>{\n      if (!error) {\n        const {name, desc, price, categoryIds} = values;\n        let pCategoryId, categoryId;\n        if (categoryIds.length===1) {\n          pCategoryId = '0';\n          categoryId = categoryIds[0]\n        } else {\n          pCategoryId = categoryIds[0];\n          categoryId = categoryIds[1];\n        }\n        const imgs = this.getImg.current.getImg();\n        const detail = this.getHtml.current.getDetail();\n        const product = {name, desc, price, imgs, detail, pCategoryId, categoryId};\n        if(this.update) {\n          product._id = this.product._id\n        }\n        const result = await reqAddOrUpdateProduct(product);\n\n        if (result.status===0) {\n          message.success(`${this.isUpdate ? '更新' : '添加'}商品成功!`);\n          this.props.history.goBack()\n        } else {\n          message.error(`${this.isUpdate ? '更新' : '添加'}商品失败!`);\n        }\n      }\n    })\n  };\n  componentWillMount() {\n    const {product}=this.props.location.state||{product:''};\n    this.update=!!product;\n    this.product=product||{}\n  }\n\n  componentDidMount() {\n    this.getCategorys('0');\n  }\n\n  render() {\n    const {getFieldDecorator} =this.props.form;\n    const {product,update}=this;\n    const {categoryId,pCategoryId}=this.product;\n    const categoryArry=[];\n    if(update){\n      if(pCategoryId=='0'){\n        categoryArry.push(categoryId);\n      }else{\n        categoryArry.push(pCategoryId);\n        categoryArry.push(categoryId);\n      }\n    }\n    const title = (\n        <span>\n        <LinkButton onClick={() => this.props.history.goBack()}>\n          <Icon type='arrow-left' style={{fontSize: 20}}/>\n        </LinkButton>\n        <span>{this.update?'修改商品':'添加商品'}</span>\n      </span>\n    );\n    const formItemLayout = {\n      labelCol: { span: 2 },\n      wrapperCol: { span: 8 },\n    };\n    return (\n        <Card title={title}>\n          <Form {...formItemLayout}>\n            <Item label=\"商品名称\">\n              {\n                getFieldDecorator('name', {\n                  initialValue:product.name,\n                  rules: [\n                    {required: true, message: '必须输入商品名称'}\n                  ]\n                })(<Input placeholder='请输入商品名称' />)\n            }\n          </Item>\n            <Item label=\"商品描述\">\n              {\n                getFieldDecorator('desc', {\n                  initialValue: product.desc,\n                  rules: [\n                    {required: true, message: '必须输入商品描述'}\n                  ]\n                })(<TextArea placeholder=\"请输入商品描述\" autosize={{ minRows: 2, maxRows: 6 }} />)\n              }\n\n            </Item>\n            <Item label=\"商品价格\">\n\n              {\n                getFieldDecorator('price', {\n                  initialValue: product.price,\n                  rules: [\n                    {required: true, message: '必须输入商品价格'},\n                    {validator:this.validatePrice}\n                  ]\n                })(<Input type='number' placeholder='请输入商品价格' addonAfter='元'/>)\n              }\n            </Item>\n            <Item label='商品图片'>\n              <PicturesWall ref={this.getImg} imgs={product.imgs}/>\n            </Item>\n            <Item label=\"商品分类\">\n              {\n                getFieldDecorator('categoryIds', {\n                  initialValue: categoryArry,\n                  rules: [\n                    {required: true, message: '必须指定商品分类'},\n                  ]\n                })(\n                    <Cascader\n                        placeholder='请指定商品分类'\n                        options={this.state.options}\n                        loadData={this.loadData}\n                        changeOnSelect\n                    />\n                )\n              }\n\n            </Item>\n            <Item labelCol={{span:2}} wrapperCol={{span:20}}>\n              <RichTextEditor ref={this.getHtml} html={product.detail}/>\n            </Item>\n            <Item>\n              <Button type='primary' onClick={this.submit}>提交</Button>\n            </Item>\n          </Form>\n        </Card>\n\n    );\n  }\n}\nexport default Form.create()(ProductAdd);"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import \"antd/es/card/style\";\nimport _Card from \"antd/es/card\";\nimport \"antd/es/modal/style\";\nimport _Modal from \"antd/es/modal\";\nimport \"antd/es/table/style\";\nimport _Table from \"antd/es/table\";\nimport \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\nimport \"antd/es/message/style\";\nimport _message from \"antd/es/message\";\nvar _jsxFileName = \"/Users/ao/WebstormProjects/react-management/src/view/role/role.jsx\";\nimport React, { Component } from 'react';\nimport { PAGE_SIZE } from '../../utils/contains';\nimport { reqRole, reqAddRole, reqUpdateRole } from '../../api/index';\nimport memoryUtils from '../../utils/memoryUtils';\nimport { formateDate } from '../../utils/dateUtils';\nimport Add from './add';\nimport Auth from './auth';\nexport default class Role extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      roles: [],\n      role: {},\n      onshow: false,\n      auth: false\n    };\n\n    this.onRow = role => {\n      return {\n        onClick: event => {\n          this.setState({\n            role\n          });\n        }\n      };\n    };\n\n    this.getRole = async () => {\n      const result = await reqRole();\n\n      if (result.status == 0) {\n        this.setState({\n          roles: result.data\n        });\n      }\n    };\n\n    this.initColumns = () => {\n      this.columns = [{\n        title: '角色名称',\n        dataIndex: 'name',\n        align: 'center'\n      }, {\n        title: '创建时间',\n        align: 'center',\n        dataIndex: 'create_time',\n        render: formateDate\n      }, {\n        title: '授权时间',\n        align: 'center',\n        dataIndex: 'auth_time',\n        render: formateDate\n      }, {\n        title: '授权人',\n        align: 'center',\n        dataIndex: 'auth_name'\n      }];\n    };\n\n    this.handleOk = () => {\n      this.setState({\n        onshow: false\n      });\n      this.form.validateFields(async (error, value) => {\n        if (!error) {\n          const role = value.roleName;\n          const result = await reqAddRole(role);\n\n          if (result.status === 0) {\n            this.form.resetFields();\n\n            _message.success('角色添加成功');\n\n            this.setState(state => ({\n              roles: [...state.roles, result.data]\n            }));\n          } else {\n            _message.error('角色添加失败');\n          }\n        }\n      });\n    };\n\n    this.handleCancel = () => {\n      this.setState({\n        onshow: false,\n        auth: false\n      });\n    };\n\n    this.updateRole = async () => {\n      this.setState({\n        auth: false\n      });\n      const role = this.state.role;\n      const menus = this.auth.current.getMenus();\n      role.menus = menus;\n      role.auth_time = Date.now();\n      role.auth_name = memoryUtils.user.username;\n      const result = await reqUpdateRole(role);\n      console.log(result);\n\n      if (result.status === 0) {\n        if (role._id === memoryUtils.user.role_id) {\n          memoryUtils.user = {};\n        }\n\n        _message.success('设置角色权限成功');\n      } else {\n        _message.error('设置权限失败');\n      }\n    };\n\n    this.auth = React.createRef();\n  }\n\n  componentWillMount() {\n    this.initColumns();\n  }\n\n  componentDidMount() {\n    this.getRole();\n  }\n\n  render() {\n    const _this$state = this.state,\n          role = _this$state.role,\n          onshow = _this$state.onshow,\n          auth = _this$state.auth;\n    const title = React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120\n      },\n      __self: this\n    }, React.createElement(_Button, {\n      type: \"primary\",\n      onClick: () => {\n        this.setState({\n          onshow: true\n        });\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 121\n      },\n      __self: this\n    }, \"\\u521B\\u5EFA\\u89D2\\u8272\"), React.createElement(_Button, {\n      type: \"primary\",\n      disabled: !role._id,\n      onClick: () => {\n        this.setState({\n          auth: true\n        });\n      },\n      style: {\n        marginLeft: 20\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 122\n      },\n      __self: this\n    }, \"\\u66F4\\u65B0\\u89D2\\u8272\\u6743\\u9650\"));\n    return React.createElement(_Card, {\n      title: title,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 126\n      },\n      __self: this\n    }, React.createElement(_Table, {\n      onRow: this.onRow,\n      columns: this.columns,\n      dataSource: this.state.roles,\n      bordered: true,\n      rowKey: \"_id\",\n      pagination: {\n        defaultPageSize: PAGE_SIZE\n      },\n      rowSelection: {\n        type: 'radio',\n        selectedRowKeys: [role._id],\n        onSelect: role => {\n          this.setState({\n            role\n          });\n        }\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 127\n      },\n      __self: this\n    }), React.createElement(_Modal, {\n      title: \"\\u521B\\u5EFA\\u89D2\\u8272\",\n      visible: onshow,\n      onOk: this.handleOk,\n      onCancel: this.handleCancel,\n      okText: \"\\u786E\\u5B9A\",\n      cancelText: \"\\u53D6\\u6D88\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141\n      },\n      __self: this\n    }, React.createElement(Add, {\n      setForm: form => {\n        this.form = form;\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149\n      },\n      __self: this\n    })), React.createElement(_Modal, {\n      title: \"\\u8BBE\\u7F6E\\u89D2\\u8272\\u6743\\u9650\",\n      visible: auth,\n      onOk: this.updateRole,\n      onCancel: this.handleCancel,\n      okText: \"\\u786E\\u5B9A\",\n      cancelText: \"\\u53D6\\u6D88\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151\n      },\n      __self: this\n    }, React.createElement(Auth, {\n      name: role.name,\n      menus: role.menus,\n      ref: this.auth,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 159\n      },\n      __self: this\n    })));\n  }\n\n}","map":{"version":3,"sources":["/Users/ao/WebstormProjects/react-management/src/view/role/role.jsx"],"names":["React","Component","PAGE_SIZE","reqRole","reqAddRole","reqUpdateRole","memoryUtils","formateDate","Add","Auth","Role","constructor","props","state","roles","role","onshow","auth","onRow","onClick","event","setState","getRole","result","status","data","initColumns","columns","title","dataIndex","align","render","handleOk","form","validateFields","error","value","roleName","resetFields","success","handleCancel","updateRole","menus","current","getMenus","auth_time","Date","now","auth_name","user","username","console","log","_id","role_id","createRef","componentWillMount","componentDidMount","marginLeft","defaultPageSize","type","selectedRowKeys","onSelect","name"],"mappings":"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","sourcesContent":["import  React,{Component} from 'react';\nimport {Card,Button,Table,Modal,message} from 'antd';\n\nimport {PAGE_SIZE} from '../../utils/contains';\nimport {reqRole,reqAddRole,reqUpdateRole} from '../../api/index';\nimport memoryUtils from '../../utils/memoryUtils';\nimport {formateDate} from '../../utils/dateUtils';\nimport Add from './add';\nimport Auth from './auth';\nexport default class Role extends  Component {\n  state={\n    roles:[],\n    role:{},\n    onshow:false,\n    auth:false\n  };\n  constructor(props){\n    super(props);\n    this.auth=React.createRef();\n  }\n  onRow=(role)=>{\n    return {\n      onClick:event=>{\n       this.setState({\n         role\n       })\n      }\n    }\n  };\n  getRole=async ()=>{\n    const result=await reqRole();\n    if(result.status==0){\n      this.setState({\n        roles:result.data,\n      })\n    }\n  };\n  initColumns=()=>{\n    this.columns=[\n      {\n        title: '角色名称',\n        dataIndex: 'name',\n        align:'center'\n      },\n      {\n        title: '创建时间',\n        align:'center',\n        dataIndex: 'create_time',\n        render:formateDate\n      },\n      {\n        title: '授权时间',\n        align:'center',\n        dataIndex: 'auth_time',\n        render:formateDate\n      },\n      {\n        title: '授权人',\n        align:'center',\n        dataIndex: 'auth_name'\n      },\n    ]\n  };\n  handleOk=()=>{\n    this.setState({\n      onshow:false\n    });\n    this.form.validateFields(async (error,value)=>{\n      if(!error){\n        const role=value.roleName;\n        const result =await reqAddRole(role);\n        if(result.status===0){\n          this.form.resetFields();\n          message.success('角色添加成功');\n          this.setState(state => ({\n            roles: [...state.roles, result.data]\n          }));\n        }else{\n          message.error('角色添加失败');\n        }\n      }\n    })\n  };\n  handleCancel=()=>{\n    this.setState({\n      onshow:false,\n      auth:false\n    })\n  };\n  updateRole=async ()=>{\n    this.setState({\n      auth:false\n    });\n    const role = this.state.role;\n    const menus=this.auth.current.getMenus();\n    role.menus=menus;\n    role.auth_time=Date.now();\n    role.auth_name = memoryUtils.user.username;\n    const result = await reqUpdateRole(role);\n    console.log(result);\n    if (result.status===0) {\n      if(role._id===memoryUtils.user.role_id){\n        memoryUtils.user={};\n        \n      }\n      message.success('设置角色权限成功');\n    }else{\n      message.error('设置权限失败');\n    }\n  };\n  componentWillMount() {\n    this.initColumns();\n  }\n  componentDidMount() {\n    this.getRole();\n  }\n  render() {\n    const {role,onshow,auth}=this.state;\n    const title=(\n        <span>\n          <Button type='primary' onClick={()=>{this.setState({onshow:true})}}>创建角色</Button>\n          <Button type='primary' disabled={!role._id} onClick={()=>{this.setState({auth:true})}} style={{marginLeft:20}}>更新角色权限</Button>\n        </span>\n    );\n    return (\n        <Card title={title}>\n          <Table\n              onRow={this.onRow}\n              columns={this.columns}\n              dataSource={this.state.roles}\n              bordered\n              rowKey='_id'\n              pagination={{defaultPageSize:PAGE_SIZE}}\n              rowSelection={{type:'radio',selectedRowKeys:[role._id],\n                onSelect: (role) => {\n                  this.setState({\n                    role\n                  })\n                }}}\n          />\n          <Modal\n              title=\"创建角色\"\n              visible={onshow}\n              onOk={this.handleOk}\n              onCancel={this.handleCancel}\n              okText='确定'\n              cancelText='取消'\n          >\n            <Add setForm={(form)=>{this.form=form}}/>\n          </Modal>\n          <Modal\n              title=\"设置角色权限\"\n              visible={auth}\n              onOk={this.updateRole}\n              onCancel={this.handleCancel}\n              okText='确定'\n              cancelText='取消'\n          >\n            <Auth name={role.name} menus={role.menus} ref={this.auth}/>\n          </Modal>\n        </Card>\n    );\n  }\n}"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import \"antd/es/card/style\";\nimport _Card from \"antd/es/card\";\nimport \"antd/es/table/style\";\nimport _Table from \"antd/es/table\";\nimport \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\nimport \"antd/es/message/style\";\nimport _message from \"antd/es/message\";\nimport \"antd/es/modal/style\";\nimport _Modal from \"antd/es/modal\";\nvar _jsxFileName = \"/Users/ao/WebstormProjects/react-management/src/view/user/user.jsx\";\nimport React, { Component } from 'react';\nimport LinkButton from '../../components/link-button/button';\nimport UserForm from './user-form';\nimport { reqUsers, reqDeleteUser, reqAddUser } from '../../api/index';\nimport { formateDate } from '../../utils/dateUtils';\nexport default class User extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      columns: [],\n      users: [],\n      roles: [],\n      isShow: false\n    };\n\n    this.initRoles = roles => {\n      const roleNames = roles.reduce((pre, role) => {\n        pre[role._id] = role.name;\n        return pre;\n      }, {});\n      this.roleNames = roleNames;\n    };\n\n    this.showUpdate = user => {\n      this.setState({\n        isShow: true\n      });\n      this.user = user;\n    };\n\n    this.deleteUser = user => {\n      _Modal.confirm({\n        title: '删除用户',\n        content: \"\\u786E\\u8BA4\\u5220\\u9664\\u7528\\u6237 \".concat(user.username, \" \\u5417\"),\n        okText: \"确认\",\n        cancelText: '取消',\n        onOk: async () => {\n          const result = await reqDeleteUser(user._id);\n\n          if (result.status === 0) {\n            _message.success('删除成功');\n\n            this.initUsers();\n          } else {\n            _message.error('删除失败');\n          }\n        }\n      });\n    };\n\n    this.addOrUpdateUser = () => {\n      this.form.validateFields(async (err, data) => {\n        if (!err) {\n          const result = await reqAddUser(data);\n\n          if (result.status === 0) {\n            this.form.resetFields();\n\n            _message.success('添加成功');\n\n            this.setState({\n              isShow: false\n            });\n            this.initUsers();\n          } else {\n            _message.error(result.msg);\n          }\n        } else {\n          _message.error('信息录入不完整');\n        }\n      });\n    };\n  }\n\n  initColumns() {\n    this.setState({\n      columns: [{\n        title: '用户名',\n        dataIndex: 'username',\n        align: 'center'\n      }, {\n        title: '邮箱',\n        align: 'center',\n        dataIndex: 'email'\n      }, {\n        title: '电话',\n        dataIndex: 'phone',\n        align: 'center'\n      }, {\n        title: '注册时间',\n        align: 'center',\n        dataIndex: 'create_time',\n        render: time => formateDate(time)\n      }, {\n        title: '所属角色',\n        align: 'center',\n        dataIndex: 'role_id',\n        render: role_id => this.roleNames[role_id]\n      }, {\n        title: '操作',\n        align: 'center',\n        render: user => React.createElement(\"span\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 50\n          },\n          __self: this\n        }, React.createElement(LinkButton, {\n          onClick: () => this.showUpdate(user),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 51\n          },\n          __self: this\n        }, \"\\u4FEE\\u6539\"), React.createElement(LinkButton, {\n          onClick: () => this.deleteUser(user),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 52\n          },\n          __self: this\n        }, \"\\u5220\\u9664\"))\n      }]\n    });\n  }\n\n  async initUsers() {\n    const result = await reqUsers();\n\n    if (result.status === 0) {\n      const _result$data = result.data,\n            users = _result$data.users,\n            roles = _result$data.roles;\n      this.initRoles(roles);\n      this.setState({\n        users,\n        roles\n      });\n    }\n  }\n\n  componentWillMount() {\n    this.initColumns();\n  }\n\n  componentDidMount() {\n    this.initUsers();\n  }\n\n  render() {\n    const title = React.createElement(_Button, {\n      type: 'primary',\n      onClick: () => {\n        this.setState({\n          isShow: true\n        });\n        this.user = null;\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125\n      },\n      __self: this\n    }, \"\\u521B\\u5EFA\\u7528\\u6237\");\n    const _this$state = this.state,\n          columns = _this$state.columns,\n          users = _this$state.users,\n          isShow = _this$state.isShow,\n          roles = _this$state.roles;\n    const user = this.user || {};\n    return React.createElement(_Card, {\n      title: title,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132\n      },\n      __self: this\n    }, React.createElement(_Table, {\n      rowKey: \"_id\",\n      bordered: true,\n      columns: columns,\n      dataSource: users,\n      pagination: {\n        defaultPageSize: 4\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133\n      },\n      __self: this\n    }), React.createElement(_Modal, {\n      title: user._id ? '修改用户' : '添加用户',\n      visible: isShow,\n      onOk: () => this.addOrUpdateUser(),\n      onCancel: () => {\n        this.setState({\n          isShow: false\n        });\n        this.form.resetFields();\n      },\n      cancelText: \"\\u53D6\\u6D88\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140\n      },\n      __self: this\n    }, React.createElement(UserForm, {\n      setForm: form => {\n        this.form = form;\n      },\n      roles: roles,\n      user: user,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147\n      },\n      __self: this\n    })));\n  }\n\n}","map":{"version":3,"sources":["/Users/ao/WebstormProjects/react-management/src/view/user/user.jsx"],"names":["React","Component","LinkButton","UserForm","reqUsers","reqDeleteUser","reqAddUser","formateDate","User","state","columns","users","roles","isShow","initRoles","roleNames","reduce","pre","role","_id","name","showUpdate","user","setState","deleteUser","confirm","title","content","username","okText","cancelText","onOk","result","status","success","initUsers","error","addOrUpdateUser","form","validateFields","err","data","resetFields","msg","initColumns","dataIndex","align","render","time","role_id","componentWillMount","componentDidMount","defaultPageSize"],"mappings":"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","sourcesContent":["import  React,{Component} from 'react';\nimport {Card,Table,Button,Modal,message} from 'antd';\n\nimport LinkButton from '../../components/link-button/button';\nimport UserForm from './user-form';\nimport {reqUsers,reqDeleteUser,reqAddUser} from '../../api/index';\nimport {formateDate} from '../../utils/dateUtils';\nexport default class User extends  Component {\n  state={\n    columns:[],\n    users:[],\n    roles:[],\n    isShow:false\n  };\n  initColumns(){\n    this.setState({\n      columns:[\n        {\n          title: '用户名',\n          dataIndex: 'username',\n          align:'center'\n        },\n        {\n          title: '邮箱',\n          align:'center',\n          dataIndex: 'email'\n        },\n\n        {\n          title: '电话',\n          dataIndex: 'phone',\n          align:'center'\n        },\n        {\n          title: '注册时间',\n          align:'center',\n          dataIndex: 'create_time',\n          render:(time)=>formateDate(time)\n        },\n        {\n          title: '所属角色',\n          align:'center',\n          dataIndex: 'role_id',\n          render:(role_id)=>this.roleNames[role_id]\n        },\n        {\n          title: '操作',\n          align:'center',\n          render: (user) => (\n              <span>\n            <LinkButton onClick={() => this.showUpdate(user)}>修改</LinkButton>\n            <LinkButton onClick={() => this.deleteUser(user)}>删除</LinkButton>\n          </span>\n          )\n        },\n      ]\n    })\n  }\n  async initUsers(){\n    const result= await reqUsers();\n    if(result.status===0){\n      const {users,roles}=result.data;\n      this.initRoles(roles);\n      this.setState({\n        users,\n        roles\n      });\n    }\n  }\n  initRoles=(roles)=>{\n    const roleNames=roles.reduce((pre,role)=>{\n      pre[role._id]=role.name;\n      return pre;\n    },{});\n    this.roleNames=roleNames;\n  };\n  showUpdate=(user)=>{\n    this.setState({isShow:true});\n    this.user=user;\n  };\n  deleteUser=(user)=>{\n    Modal.confirm({\n      title:'删除用户',\n      content:`确认删除用户 ${user.username} 吗`,\n      okText:\"确认\",\n      cancelText:'取消',\n      onOk:async ()=>{\n        const result=await reqDeleteUser(user._id);\n        if(result.status===0){\n          message.success('删除成功');\n          this.initUsers();\n        }else{\n          message.error('删除失败');\n        }\n      }\n    })\n  };\n  addOrUpdateUser=()=>{\n    this.form.validateFields(async (err,data)=>{\n      if(!err){\n        const result=await reqAddUser(data);\n        if(result.status===0){\n          this.form.resetFields();\n          message.success('添加成功');\n          this.setState({\n            isShow:false\n          });\n          this.initUsers();\n        }else{\n          message.error(result.msg);\n        }\n      }else{\n        message.error('信息录入不完整');\n      }\n    })\n  };\n  componentWillMount() {\n   this.initColumns();\n  }\n  componentDidMount(){\n    this.initUsers();\n  }\n  render() {\n    const title=(\n        <Button type={'primary'} onClick={()=>{this.setState({isShow:true});this.user=null;}}>\n          创建用户\n        </Button>\n    );\n    const {columns,users,isShow,roles}=this.state;\n    const user=this.user||{};\n    return (\n        <Card title={title}>\n          <Table\n              rowKey='_id'\n              bordered={true}\n              columns={columns}\n              dataSource={users}\n              pagination={{defaultPageSize:4}}\n          />\n          <Modal\n              title={user._id?'修改用户':'添加用户'}\n              visible={isShow}\n              onOk={()=>this.addOrUpdateUser()}\n              onCancel={()=>{this.setState({isShow:false});this.form.resetFields();}}\n              cancelText='取消'\n          >\n            <UserForm\n                setForm={(form)=>{this.form=form}}\n                roles={roles}\n                user={user}\n            />\n          </Modal>\n        </Card>\n    );\n  }\n}"]},"metadata":{},"sourceType":"module"}